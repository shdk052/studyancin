import React, { useState, useEffect } from 'react';
import { Book, Layers, CheckCircle, Trophy, ArrowRight, ArrowLeft, Sparkles, Menu, X } from 'lucide-react';

/**
 * Vocabulary Master - Clean Production Version for GitHub
 * רשימת המילים המעודכנת שסיפקת
 */
const vocabulary = [
  { en: "Breathe", he: "לנשום" },
  { en: "Invent", he: "להמציא" },
  { en: "Sense", he: "חוש / היגיון" },
  { en: "Literature", he: "ספרות" },
  { en: "Essential", he: "חיוני / בסיסי" },
  { en: "Fee", he: "עמלה / תשלום" },
  { en: "Assume", he: "להניח" },
  { en: "Refuse", he: "לסרב" },
  { en: "Convince", he: "לשכנע" },
  { en: "Secret", he: "סוד" },
  { en: "Bill", he: "חשבון / שטר" },
  { en: "Design", he: "עיצוב / לתכנן" },
  { en: "Positive", he: "חיובי" },
  { en: "Tear", he: "דמעה / לקרוע" },
  { en: "Plenty of", he: "שפע של / הרבה" },
  { en: "Experience", he: "ניסיון / חוויה" },
  { en: "Advertisement", he: "פרסומת" },
  { en: "Congratulations", he: "מזל טוב / ברכות" },
  { en: "Despite", he: "למרות" },
  { en: "Offer", he: "להציע / הצעה" },
  { en: "Clear", he: "ברור" },
  { en: "Somehow", he: "איכשהו" }
];

export default function App() {
  const [activeTab, setActiveTab] = useState('dictionary');
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

  const handleTabChange = (tab) => {
    setActiveTab(tab);
    setIsMobileMenuOpen(false);
  };

  return (
    <div dir="rtl" className="min-h-screen bg-slate-900 text-slate-100 selection:bg-cyan-500 selection:text-white font-sans">
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@200;400;700;800&display=swap');
        body { font-family: 'Assistant', sans-serif; }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
      `}</style>

      {/* Header Section */}
      <header className="relative overflow-hidden bg-slate-950 border-b border-cyan-900 shadow-2xl">
        <div className="max-w-4xl mx-auto px-4 py-6 relative z-10">
          <div className="flex justify-between items-center md:justify-center">
            <div className="flex items-center gap-3">
              <Sparkles className="text-cyan-400" size={24} />
              <h1 className="text-2xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-300 to-blue-400 tracking-tight">
                VOCABULARY MASTER
              </h1>
            </div>

            {/* Mobile Menu Toggle */}
            <button
              className="md:hidden p-2 rounded-lg text-cyan-400 hover:bg-slate-800 transition-colors z-50"
              onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
              aria-label="Toggle menu"
            >
              {isMobileMenuOpen ? <X size={24} /> : <Menu size={24} />}
            </button>
          </div>
        </div>
        
        {/* Desktop Navigation */}
        <div className="hidden md:flex justify-center gap-4 p-4 bg-slate-900/50 backdrop-blur-sm">
          <NavButton active={activeTab === 'dictionary'} onClick={() => handleTabChange('dictionary')} icon={<Book size={18} />} label="מילון" />
          <NavButton active={activeTab === 'flashcards'} onClick={() => handleTabChange('flashcards')} icon={<Layers size={18} />} label="כרטיסיות" />
          <NavButton active={activeTab === 'quiz'} onClick={() => handleTabChange('quiz')} icon={<CheckCircle size={18} />} label="מבחן" />
        </div>

        {/* Mobile Navigation Menu */}
        {isMobileMenuOpen && (
          <div className="fixed inset-0 top-[4.5rem] bg-slate-900/95 backdrop-blur-md border-t border-cyan-900 shadow-xl z-40 md:hidden animate-in fade-in slide-in-from-top-4 duration-300">
            <div className="flex flex-col p-4 space-y-2">
              <MobileMenuItem active={activeTab === 'dictionary'} onClick={() => handleTabChange('dictionary')} icon={<Book size={20} />} label="מילון" />
              <MobileMenuItem active={activeTab === 'flashcards'} onClick={() => handleTabChange('flashcards')} icon={<Layers size={20} />} label="כרטיסיות" />
              <MobileMenuItem active={activeTab === 'quiz'} onClick={() => handleTabChange('quiz')} icon={<CheckCircle size={20} />} label="מבחן" />
            </div>
          </div>
        )}
      </header>

      {/* Main Content Area */}
      <main className="max-w-4xl mx-auto p-4 md:p-8 min-h-[80vh]">
        {activeTab === 'dictionary' && <DictionaryView data={vocabulary} />}
        {activeTab === 'flashcards' && <FlashcardsView data={vocabulary} />}
        {activeTab === 'quiz' && <QuizView data={vocabulary} />}
      </main>

      <footer className="text-center py-8 text-slate-500 text-sm border-t border-slate-800 mt-12">
        Vocabulary Master &copy; {new Date().getFullYear()}
      </footer>
    </div>
  );
}

// Components for UI elements
const NavButton = ({ active, onClick, icon, label }) => (
  <button
    onClick={onClick}
    className={`flex items-center gap-2 px-5 py-2.5 rounded-xl transition-all duration-300 border ${
      active 
        ? 'bg-cyan-500/10 border-cyan-500 text-cyan-300 shadow-[0_0_15px_rgba(6,182,212,0.3)]' 
        : 'bg-slate-800/50 border-transparent text-slate-400 hover:text-cyan-200 hover:border-slate-700'
    }`}
  >
    {icon}
    <span className="font-bold">{label}</span>
  </button>
);

const MobileMenuItem = ({ active, onClick, icon, label }) => (
  <button
    onClick={onClick}
    className={`flex items-center gap-3 w-full p-4 rounded-lg text-right transition-all duration-200 ${
      active ? 'bg-cyan-700/30 text-cyan-300 font-bold border-r-4 border-cyan-500' : 'text-slate-300 hover:bg-slate-800'
    }`}
  >
    {icon}
    <span className="text-lg">{label}</span>
  </button>
);

const DictionaryView = ({ data }) => {
  return (
    <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
      <div className="bg-slate-800/50 rounded-3xl border border-slate-700 overflow-hidden backdrop-blur-sm shadow-xl">
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-px bg-slate-700/50">
          {data.map((item, index) => (
            <div key={index} className="group bg-slate-800/80 p-6 hover:bg-slate-700/80 transition-all duration-300">
              <div className="flex flex-col h-full justify-center">
                <span className="text-xl font-extrabold text-cyan-300 mb-1">{item.en}</span>
                <div className="h-px w-8 bg-slate-600 mb-2 group-hover:w-full group-hover:bg-cyan-500/50 transition-all duration-500"></div>
                <span className="text-slate-300 font-medium text-sm">{item.he}</span>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

const FlashcardsView = ({ data }) => {
  const [currentIndex, setCurrentIndex] = useState(0);
  const [isFlipped, setIsFlipped] = useState(false);
  const [direction, setDirection] = useState(0); 
  
  const currentCard = data[currentIndex];

  const move = (dir) => {
    setIsFlipped(false);
    setDirection(dir);
    setTimeout(() => {
      setCurrentIndex((prev) => (prev + dir + data.length) % data.length);
      setDirection(0);
    }, 300);
  };

  return (
    <div className="flex flex-col items-center justify-center min-h-[60vh] animate-in fade-in duration-700">
      <div className="mb-8 flex items-center gap-3">
        <span className="text-cyan-500 font-mono text-sm">#{currentIndex + 1}</span>
        <div className="h-1.5 w-32 bg-slate-800 rounded-full overflow-hidden">
          <div className="h-full bg-cyan-500 transition-all duration-300" style={{ width: `${((currentIndex + 1) / data.length) * 100}%` }} />
        </div>
        <span className="text-slate-500 font-mono text-sm">/{data.length}</span>
      </div>

      <div className="perspective-1000 w-full max-w-sm h-72 cursor-pointer" onClick={() => setIsFlipped(!isFlipped)}>
        <div className={`relative w-full h-full duration-700 transform-style-3d transition-all ${isFlipped ? 'rotate-y-180' : ''} ${direction !== 0 ? 'opacity-0 scale-95' : 'opacity-100 scale-100'}`}>
          <div className="absolute inset-0 backface-hidden bg-slate-800 rounded-3xl border border-cyan-500/30 flex flex-col items-center justify-center shadow-2xl">
            <h2 className="text-4xl font-black text-white px-2 text-center">{currentCard.en}</h2>
            <div className="mt-4 text-cyan-500 text-xs animate-pulse font-bold">לחץ להפיכה</div>
          </div>
          <div className="absolute inset-0 backface-hidden rotate-y-180 bg-cyan-600 rounded-3xl flex items-center justify-center border border-cyan-400/50 shadow-2xl">
            <h2 className="text-2xl font-bold text-white text-center px-6">{currentCard.he}</h2>
          </div>
        </div>
      </div>

      <div className="flex items-center gap-8 mt-12">
        <button onClick={() => move(-1)} className="p-4 rounded-full bg-slate-800 text-cyan-400 border border-slate-700 hover:scale-110 active:scale-95 transition-all shadow-lg"><ArrowRight size={24}/></button>
        <button onClick={() => move(1)} className="p-4 rounded-full bg-cyan-500 text-white shadow-lg hover:scale-110 active:scale-95 transition-all"><ArrowLeft size={24}/></button>
      </div>
    </div>
  );
};

const QuizView = ({ data }) => {
  const [currentIdx, setCurrentIdx] = useState(0);
  const [score, setScore] = useState(0);
  const [showResult, setShowResult] = useState(false);
  const [selected, setSelected] = useState(null);
  const [options, setOptions] = useState([]);

  useEffect(() => {
    if (currentIdx < data.length) {
      const correct = data[currentIdx];
      const others = [...data]
        .filter((_, idx) => idx !== currentIdx)
        .sort(() => 0.5 - Math.random())
        .slice(0, 3);
      setOptions([correct, ...others].sort(() => 0.5 - Math.random()));
      setSelected(null);
    } else {
      setShowResult(true);
    }
  }, [currentIdx, data]);

  const handleSelect = (opt) => {
    if (selected) return;
    setSelected(opt);
    if (opt.he === data[currentIdx].he) setScore(s => s + 1);
    setTimeout(() => setCurrentIdx(prev => prev + 1), 1200);
  };

  if (showResult) return (
    <div className="flex flex-col items-center justify-center min-h-[50vh] text-center p-4 animate-in zoom-in duration-500">
        <div className="bg-slate-800 p-10 rounded-[2rem] border border-slate-700 max-w-md w-full shadow-2xl">
            <Trophy size={60} className="text-yellow-400 mx-auto mb-6" />
            <h2 className="text-3xl font-black text-white mb-2">סיימת את המבחן!</h2>
            <div className="text-6xl font-black text-cyan-400 mb-8">{score} / {data.length}</div>
            <button 
              onClick={() => {setCurrentIdx(0); setScore(0); setShowResult(false);}} 
              className="w-full py-4 bg-cyan-600 hover:bg-cyan-500 text-white rounded-xl font-bold transition-all shadow-lg active:scale-95"
            >
              נסה שוב
            </button>
        </div>
    </div>
  );

  return (
    <div className="max-w-xl mx-auto animate-in fade-in duration-500">
      <div className="h-2 bg-slate-800 rounded-full mb-8 overflow-hidden">
        <div className="h-full bg-cyan-500 transition-all duration-500" style={{ width: `${(currentIdx / data.length) * 100}%` }} />
      </div>
      <div className="bg-slate-800 rounded-2xl p-10 mb-8 text-center border border-slate-700 shadow-xl">
        <span className="text-cyan-500/70 text-sm uppercase font-bold block mb-2">איך אומרים באנגלית:</span>
        <h2 className="text-5xl font-black text-white tracking-tight">{data[currentIdx].en}</h2>
      </div>
      <div className="space-y-3">
        {options.map((opt, i) => (
          <button 
            key={i} 
            onClick={() => handleSelect(opt)} 
            disabled={!!selected} 
            className={`w-full p-4 text-right rounded-xl border transition-all font-bold text-lg shadow-sm ${
              selected 
                ? (opt.he === data[currentIdx].he 
                    ? 'bg-green-500/20 border-green-500 text-green-300' 
                    : (selected === opt ? 'bg-red-500/20 border-red-500 text-red-300' : 'opacity-40')) 
                : 'bg-slate-800 border-slate-700 hover:border-cyan-500 text-slate-300 hover:bg-slate-750'
            }`}
          >
            {opt.he}
          </button>
        ))}
      </div>
    </div>
  );
};
